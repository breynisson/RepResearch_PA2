---
title: Severe weather events on population health and economics.
author: "Bjorgvin Reynisson"
output: html_document
---

## Synopsis

## Data Processing

The data is read and we use the str() to take a peek at the data:

```{r, cache=TRUE}
data<-read.csv("repdata-data-StormData.csv.bz2")
str(data)
```

## Analysis

### The analysis of Fatalities and Injuries. Summary statistics for the United States.
We order the dataset based on the fatalities and injuries.

```{r}
ordered_by_fatalities<-data[order(-data$FATALITIES),]
ordered_by_injuries<-data[order(-data$INJURIES),]
```

We will select the top-20 event-types from each dataset and look at those in more detail.

```{r}
top_fatalities<-ordered_by_fatalities[1:20,]
tf<-top_fatalities[,c("EVTYPE", "FATALITIES")]
tf
top_injuries<-ordered_by_injuries[1:20,]
ti<-top_injuries[,c("EVTYPE", "INJURIES")]
ti
```

```{r}
library(plyr)
c_tf<-count(tf, vars = "EVTYPE", wt_var = "FATALITIES")
c_ti<-count(ti, vars = "EVTYPE", wt_var = "INJURIES")
c_tf[order(-c_tf$freq),]
c_ti[order(-c_ti$freq),]
```

From the two tables, we see that tornados are the biggest cause of injuries in the US, and the second biggest cause of fatalities. The number one cause of fatalities in the US is heat. 

### The analysis of Fatalities and Injuries. State-by-state analysis.

We would like to analyze the fatalities and injuries caused by weather in each state.

```{r}
fatalities_by_state<-data[order(data$STATE, -data$FATALITIES),]
injuries_by_state<-data[order(data$STATE, -data$INJURIES),]
```

We trim the data to just the STATE, EVTYPE and FATALITIES or INJURIES variables.

```{r}
fatalities_by_state<-fatalities_by_state[,c("STATE", "EVTYPE", "FATALITIES")]
injuries_by_state<-injuries_by_state[,c("STATE", "EVTYPE", "INJURIES")]
```

Then sum the datasets by state:

```{r}
fatalities_by_state_s<-ddply(fatalities_by_state, .(STATE, EVTYPE), 
                             summarize, FATALITIES=sum(FATALITIES))
injuries_by_state_s<-ddply(injuries_by_state, .(STATE, EVTYPE), 
                             summarize, INJURIES=sum(INJURIES))

```

And sort by decsending number of fatalities/injuries per state:

```{r}
fatalities_by_state_r<-arrange(fatalities_by_state_s, 
                               fatalities_by_state_s$STATE,
                               -fatalities_by_state_s$FATALITIES)
injuries_by_state_r<-arrange(injuries_by_state_s, 
                               injuries_by_state_s$STATE,
                               -injuries_by_state_s$INJURIES)

```

We then reduce the data to the top three fatalities/injury causes in each state:

```{r}
top_fatalities_per_state<-ddply(fatalities_by_state_r, .(STATE), function(x)x[1:3,])
top_injuries_per_state<-ddply(injuries_by_state_r, .(STATE), function(x)x[1:3,])
```


## Results













